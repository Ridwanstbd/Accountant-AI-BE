openapi: 3.0.3
info:
  title: Accounting Management API
  description: |
    RESTful API untuk sistem manajemen akuntansi dengan fitur:
    - Chart of Accounts (Bagan Akun)
    - Journal Management (Jurnal)
    - Customer Management (Pelanggan)
    - Sales Management (Penjualan)
    - AI Recommendations (Rekomendasi AI)
    - Authentication & Authorization (Autentikasi & Otorisasi)
    - User Management (Manajemen Pengguna)
    - Business Management (Manajemen Bisnis)
    - Permission & Role Management (Manajemen Izin & Peran)
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.accounting.com
    description: Production server

tags:
  - name: Health
    description: API health check
  - name: Accounts
    description: Chart of Accounts management
  - name: Journals
    description: Journal entries and posting
  - name: Customers
    description: Customer management
  - name: Sales
    description: Sales transactions
  - name: Recommendations
    description: AI-powered business recommendations
  - name: Authentication
    description: User authentication and authorization
  - name: Users
    description: User management operations
  - name: Business
    description: Business management operations
  - name: Permissions
    description: Permission management operations
  - name: Roles
    description: Role management operations

paths:
  # Health Check
  /health:
    get:
      tags:
        - Health
      summary: API Health Check
      description: Check if API is running properly
      responses:
        "200":
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  # Authentication Endpoints
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register User
      description: Create a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          description: Email already exists
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login User
      description: Authenticate user and return access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          accessToken:
                            type: string
                          refreshToken:
                            type: string
                          user:
                            $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid credentials
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Forgot Password
      description: Send password reset email to user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: Password reset email sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          description: User not found
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset Password
      description: Reset user password using reset token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid or expired token
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/refresh-token:
    post:
      tags:
        - Authentication
      summary: Refresh Access Token
      description: Generate a new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          accessToken:
                            type: string
                          refreshToken:
                            type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid refresh token
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/profile:
    get:
      tags:
        - Authentication
      summary: Get User Profile
      description: Get the profile of the currently authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfileResponse"
        "401":
          description: Unauthorized
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/join-business:
    post:
      tags:
        - Authentication
      summary: Join Business
      description: Join a business using business code and invite code
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JoinBusinessRequest"
      responses:
        "200":
          description: Successfully joined business
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/BusinessUser"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Unauthorized
        "404":
          description: Business not found
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change Password
      description: Change the current user's password
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid current password
        "500":
          $ref: "#/components/responses/InternalServerError"

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout
      description: Logout the current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "401":
          description: Unauthorized
        "500":
          $ref: "#/components/responses/InternalServerError"

  # User Endpoints
  /users/profile:
    put:
      tags:
        - Users
      summary: Update User Profile
      description: Update profile information for the currently authenticated user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users:
    get:
      tags:
        - Users
      summary: Get All Users
      description: Retrieve a list of all users in the system
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Users
      summary: Create User
      description: Create a new user in the system
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users/{id}:
    get:
      tags:
        - Users
      summary: Get User by ID
      description: Retrieve a specific user by their ID
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDetailResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - Users
      summary: Update User
      description: Update user information
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Users
      summary: Delete User
      description: Delete a user from the system
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users/{id}/roles:
    post:
      tags:
        - Users
      summary: Assign Role to User
      description: Assign a role to a specific user
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignRoleRequest"
      responses:
        "200":
          description: Role assigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserRole"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Users
      summary: Remove Role from User
      description: Remove a role from a specific user
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
        - name: roleId
          in: path
          required: true
          description: Role ID to remove
          schema:
            type: string
      responses:
        "200":
          description: Role removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users/{id}/deactivate:
    patch:
      tags:
        - Users
      summary: Deactivate User
      description: Deactivate a user account (Super Admin only)
      security:
        - bearerAuth: []
        - superAdminAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: User deactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users/{id}/activate:
    patch:
      tags:
        - Users
      summary: Activate User
      description: Activate a user account (Super Admin only)
      security:
        - bearerAuth: []
        - superAdminAuth: []
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: User activated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Business Endpoints
  /business/my-businesses:
    get:
      tags:
        - Business
      summary: Get User Businesses
      description: Retrieve all businesses that the current user is a member of
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Businesses retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Business"
        "401":
          description: Unauthorized
        "500":
          $ref: "#/components/responses/InternalServerError"

  /business:
    post:
      tags:
        - Business
      summary: Create Business
      description: Create a new business (requires global permission)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBusinessRequest"
      responses:
        "201":
          description: Business created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Business"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

  /business/{businessId}:
    get:
      tags:
        - Business
      summary: Get Business by ID
      description: Retrieve a specific business by its ID
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/BusinessId"
      responses:
        "200":
          description: Business retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Business"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - Business
      summary: Update Business
      description: Update business information
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/BusinessId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBusinessRequest"
      responses:
        "200":
          description: Business updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Business"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /business/{businessId}/users:
    get:
      tags:
        - Business
      summary: Get Business Users
      description: Retrieve all users in a specific business
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/BusinessId"
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: Business users retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/BusinessUser"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Business
      summary: Assign User Role
      description: Assign a role to a user in the business
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/BusinessId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignBusinessRoleRequest"
      responses:
        "200":
          description: Role assigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/BusinessUser"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Business
      summary: Remove User from Business
      description: Remove a user from the business
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/BusinessId"
        - name: userId
          in: path
          required: true
          description: User ID to remove
          schema:
            type: string
      responses:
        "200":
          description: User removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Permission Endpoints
  /permissions:
    get:
      tags:
        - Permissions
      summary: Get All Permissions
      description: Retrieve a list of all permissions in the system
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Permissions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Permission"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Permissions
      summary: Create Permission
      description: Create a new permission (requires permission_create)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePermissionRequest"
      responses:
        "201":
          description: Permission created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Permissions
      summary: Create Multiple Permissions
      description: Create multiple permissions at once (requires permission_create)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateMultiplePermissionsRequest"
      responses:
        "201":
          description: Permissions created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

  /permissions/modules:
    get:
      tags:
        - Permissions
      summary: Get Permissions by Module
      description: Retrieve permissions grouped by module (requires permission_view)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Permissions retrieved by module successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        additionalProperties:
                          type: array
                          items:
                            $ref: "#/components/schemas/Permission"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

  /permissions/{id}:
    get:
      tags:
        - Permissions
      summary: Get Permission by ID
      description: Retrieve a specific permission by its ID (requires permission_view)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PermissionId"
      responses:
        "200":
          description: Permission retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Permission"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - Permissions
      summary: Update Permission
      description: Update an existing permission (requires permission_update)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PermissionId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePermissionRequest"
      responses:
        "200":
          description: Permission updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Permission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Permissions
      summary: Delete Permission
      description: Delete a permission (requires permission_delete)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PermissionId"
      responses:
        "200":
          description: Permission deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Role Endpoints
  /roles:
    get:
      tags:
        - Roles
      summary: Get All Roles
      description: Retrieve a list of all roles in the system
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Role"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Roles
      summary: Create Role
      description: Create a new role (requires role_create)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRoleRequest"
      responses:
        "201":
          description: Role created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Role"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "500":
          $ref: "#/components/responses/InternalServerError"

  /roles/{id}:
    get:
      tags:
        - Roles
      summary: Get Role by ID
      description: Retrieve a specific role by its ID (requires role_view)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
      responses:
        "200":
          description: Role retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Role"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - Roles
      summary: Update Role
      description: Update an existing role (requires role_update)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRoleRequest"
      responses:
        "200":
          description: Role updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Role"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Roles
      summary: Delete Role
      description: Delete a role (requires role_delete)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
      responses:
        "200":
          description: Role deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /roles/{id}/permissions:
    post:
      tags:
        - Roles
      summary: Assign Permission to Role
      description: Assign a permission to a role (requires role_assign_permissions)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignPermissionRequest"
      responses:
        "200":
          description: Permission assigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/RolePermission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags:
        - Roles
      summary: Assign Multiple Permissions to Role
      description: Assign multiple permissions to a role (requires role_assign_permissions)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignMultiplePermissionsRequest"
      responses:
        "200":
          description: Permissions assigned successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/RolePermission"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    delete:
      tags:
        - Roles
      summary: Remove Permission from Role
      description: Remove a permission from a role (requires role_assign_permissions)
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/RoleId"
        - name: permissionId
          in: path
          required: true
          description: Permission ID to remove
          schema:
            type: string
      responses:
        "200":
          description: Permission removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Insufficient permissions
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Accounts Endpoints
  /accounts:
    get:
      tags:
        - Accounts
      summary: Get all accounts
      description: Retrieve all accounts with optional filtering
      parameters:
        - name: type
          in: query
          description: Filter by account type
          schema:
            type: string
            enum: [ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE]
        - name: category
          in: query
          description: Filter by account category
          schema:
            type: string
        - name: active
          in: query
          description: Filter by active status
          schema:
            type: string
            enum: ["true", "false"]
      responses:
        "200":
          description: Accounts retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountsResponse"

    post:
      tags:
        - Accounts
      summary: Create new account
      description: Create a new account in chart of accounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAccountRequest"
      responses:
        "201":
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /accounts/{id}:
    get:
      tags:
        - Accounts
      summary: Get account by ID
      description: Retrieve specific account with entries
      parameters:
        - $ref: "#/components/parameters/AccountId"
      responses:
        "200":
          description: Account retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountDetailResponse"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Accounts
      summary: Update account
      description: Update account information
      parameters:
        - $ref: "#/components/parameters/AccountId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAccountRequest"
      responses:
        "200":
          description: Account updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"

  /accounts/{id}/deactivate:
    patch:
      tags:
        - Accounts
      summary: Deactivate account
      description: Set account status to inactive
      parameters:
        - $ref: "#/components/parameters/AccountId"
      responses:
        "200":
          description: Account deactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"

  /accounts/trial-balance:
    get:
      tags:
        - Accounts
      summary: Get trial balance
      description: Retrieve trial balance report
      responses:
        "200":
          description: Trial balance retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrialBalanceResponse"

  # Journal Endpoints
  /journals:
    get:
      tags:
        - Journals
      summary: Get all journals
      description: Retrieve journals with optional filtering
      parameters:
        - name: type
          in: query
          description: Filter by journal type
          schema:
            type: string
            enum: [GENERAL, SALES, PURCHASE, PAYMENT]
        - name: status
          in: query
          description: Filter by journal status
          schema:
            type: string
            enum: [DRAFT, POSTED, CANCELLED]
        - name: startDate
          in: query
          description: Filter from start date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Filter to end date (YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Journals retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalsResponse"

    post:
      tags:
        - Journals
      summary: Create journal entry
      description: Create a new journal entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateJournalRequest"
      responses:
        "201":
          description: Journal created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalResponse"

  /journals/sales:
    post:
      tags:
        - Journals
      summary: Create sales journal
      description: Create journal entry from sales transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSalesJournalRequest"
      responses:
        "201":
          description: Sales journal created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalResponse"

  /journals/{id}:
    get:
      tags:
        - Journals
      summary: Get journal by ID
      description: Retrieve specific journal with entries
      parameters:
        - $ref: "#/components/parameters/JournalId"
      responses:
        "200":
          description: Journal retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalDetailResponse"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - Journals
      summary: Delete journal
      description: Delete journal entry (only if status is DRAFT)
      parameters:
        - $ref: "#/components/parameters/JournalId"
      responses:
        "200":
          description: Journal deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /journals/{id}/post:
    patch:
      tags:
        - Journals
      summary: Post journal
      description: Post journal entry and update account balances
      parameters:
        - $ref: "#/components/parameters/JournalId"
      responses:
        "200":
          description: Journal posted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JournalResponse"

  # Customer Endpoints
  /customers:
    get:
      tags:
        - Customers
      summary: Get all customers
      description: Retrieve all customers with optional search
      parameters:
        - name: search
          in: query
          description: Search by name, code, or email
          schema:
            type: string
      responses:
        "200":
          description: Customers retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomersResponse"

    post:
      tags:
        - Customers
      summary: Create customer
      description: Create a new customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCustomerRequest"
      responses:
        "201":
          description: Customer created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"

  /customers/{id}:
    get:
      tags:
        - Customers
      summary: Get customer by ID
      description: Retrieve specific customer with sales history
      parameters:
        - $ref: "#/components/parameters/CustomerId"
      responses:
        "200":
          description: Customer retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerDetailResponse"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Customers
      summary: Update customer
      description: Update customer information
      parameters:
        - $ref: "#/components/parameters/CustomerId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCustomerRequest"
      responses:
        "200":
          description: Customer updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"

    delete:
      tags:
        - Customers
      summary: Delete customer
      description: Delete customer (only if no sales transactions)
      parameters:
        - $ref: "#/components/parameters/CustomerId"
      responses:
        "200":
          description: Customer deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  # Sales Endpoints
  /sales:
    get:
      tags:
        - Sales
      summary: Get all sales
      description: Retrieve sales with optional filtering
      parameters:
        - name: status
          in: query
          description: Filter by sale status
          schema:
            type: string
            enum: [PENDING, CONFIRMED, COMPLETED, CANCELLED]
        - name: customerId
          in: query
          description: Filter by customer ID
          schema:
            type: string
        - name: startDate
          in: query
          description: Filter from start date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Filter to end date (YYYY-MM-DD)
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Sales retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SalesResponse"

    post:
      tags:
        - Sales
      summary: Create sale
      description: Create a new sales transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSaleRequest"
      responses:
        "201":
          description: Sale created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SaleResponse"

  /sales/{id}:
    get:
      tags:
        - Sales
      summary: Get sale by ID
      description: Retrieve specific sale with items
      parameters:
        - $ref: "#/components/parameters/SaleId"
      responses:
        "200":
          description: Sale retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SaleDetailResponse"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - Sales
      summary: Delete sale
      description: Delete sale (only if status is PENDING)
      parameters:
        - $ref: "#/components/parameters/SaleId"
      responses:
        "200":
          description: Sale deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /sales/{id}/status:
    patch:
      tags:
        - Sales
      summary: Update sale status
      description: Update status of sales transaction
      parameters:
        - $ref: "#/components/parameters/SaleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSaleStatusRequest"
      responses:
        "200":
          description: Sale status updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SaleResponse"

  /sales/report:
    get:
      tags:
        - Sales
      summary: Get sales report
      description: Get comprehensive sales report with analytics
      parameters:
        - name: startDate
          in: query
          description: Report start date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Report end date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: customerId
          in: query
          description: Filter by customer ID
          schema:
            type: string
      responses:
        "200":
          description: Sales report retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SalesReportResponse"

  # Recommendations Endpoints
  /recommendations:
    get:
      tags:
        - Recommendations
      summary: Get recommendations
      description: Retrieve AI recommendations with filtering and pagination
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: year
          in: query
          schema:
            type: integer
        - name: month
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
        - name: type
          in: query
          schema:
            type: string
        - name: isCustom
          in: query
          schema:
            type: boolean
        - name: userId
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: sortBy
          in: query
          schema:
            type: string
            default: generatedAt
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        "200":
          description: Recommendations retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecommendationsResponse"

    delete:
      tags:
        - Recommendations
      summary: Bulk delete recommendations
      description: Delete multiple recommendations by IDs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BulkDeleteRequest"
      responses:
        "200":
          description: Recommendations deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BulkDeleteResponse"

  /recommendations/monthly:
    post:
      tags:
        - Recommendations
      summary: Generate monthly recommendation
      description: Generate AI recommendation for specific month
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateMonthlyRecommendationRequest"
      responses:
        "200":
          description: Monthly recommendation generated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecommendationGeneratedResponse"

  /recommendations/custom:
    post:
      tags:
        - Recommendations
      summary: Generate custom recommendation
      description: Generate AI recommendation with custom prompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateCustomRecommendationRequest"
      responses:
        "200":
          description: Custom recommendation generated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomRecommendationResponse"

  /recommendations/variations:
    post:
      tags:
        - Recommendations
      summary: Generate recommendation variations
      description: Generate multiple variations of recommendations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateVariationsRequest"
      responses:
        "200":
          description: Recommendation variations generated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VariationsResponse"

  /recommendations/analyze:
    post:
      tags:
        - Recommendations
      summary: Analyze financial data
      description: Analyze financial data with AI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AnalyzeFinancialDataRequest"
      responses:
        "200":
          description: Financial data analyzed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FinancialAnalysisResponse"

  /recommendations/test-ai:
    get:
      tags:
        - Recommendations
      summary: Test AI connection
      description: Test connection to AI service
      parameters:
        - name: model
          in: query
          description: AI model to test
          schema:
            type: string
      responses:
        "200":
          description: AI connection test successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AITestResponse"

  /recommendations/models:
    get:
      tags:
        - Recommendations
      summary: Get available AI models
      description: Retrieve list of available AI models
      responses:
        "200":
          description: Available models retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AIModelsResponse"

  /recommendations/status:
    get:
      tags:
        - Recommendations
      summary: Get service status
      description: Get status of recommendation service
      responses:
        "200":
          description: Service status retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServiceStatusResponse"

  /recommendations/export:
    get:
      tags:
        - Recommendations
      summary: Export recommendations
      description: Export recommendations in various formats
      parameters:
        - name: format
          in: query
          description: Export format
          schema:
            type: string
            enum: [json, csv, pdf]
            default: json
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: type
          in: query
          schema:
            type: string
      responses:
        "200":
          description: Recommendations exported successfully

  /recommendations/{id}:
    get:
      tags:
        - Recommendations
      summary: Get recommendation by ID
      description: Retrieve specific recommendation
      parameters:
        - $ref: "#/components/parameters/RecommendationId"
      responses:
        "200":
          description: Recommendation retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecommendationResponse"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - Recommendations
      summary: Update recommendation
      description: Update recommendation content
      parameters:
        - $ref: "#/components/parameters/RecommendationId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRecommendationRequest"
      responses:
        "200":
          description: Recommendation updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecommendationResponse"

    delete:
      tags:
        - Recommendations
      summary: Delete recommendation
      description: Delete recommendation (soft delete)
      parameters:
        - $ref: "#/components/parameters/RecommendationId"
      responses:
        "200":
          description: Recommendation deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"

  /recommendations/{id}/regenerate:
    post:
      tags:
        - Recommendations
      summary: Regenerate recommendation
      description: Regenerate existing recommendation
      parameters:
        - $ref: "#/components/parameters/RecommendationId"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegenerateRecommendationRequest"
      responses:
        "200":
          description: Recommendation regenerated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegenerateResponse"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    superAdminAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Requires superadmin role

  parameters:
    AccountId:
      name: id
      in: path
      required: true
      description: Account ID
      schema:
        type: string

    JournalId:
      name: id
      in: path
      required: true
      description: Journal ID
      schema:
        type: string

    CustomerId:
      name: id
      in: path
      required: true
      description: Customer ID
      schema:
        type: string

    SaleId:
      name: id
      in: path
      required: true
      description: Sale ID
      schema:
        type: string

    RecommendationId:
      name: id
      in: path
      required: true
      description: Recommendation ID
      schema:
        type: string

    UserId:
      name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string

    BusinessId:
      name: businessId
      in: path
      required: true
      description: Business ID
      schema:
        type: string

    PermissionId:
      name: id
      in: path
      required: true
      description: Permission ID
      schema:
        type: string

    RoleId:
      name: id
      in: path
      required: true
      description: Role ID
      schema:
        type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # Base Response Schemas
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
      required:
        - success
        - message

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error message"
      required:
        - success
        - message

    HealthResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            timestamp:
              type: string
              format: date-time

    # User Management Schemas
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        username:
          type: string
        isSuperAdmin:
          type: boolean
        isActive:
          type: boolean
        profile:
          type: object
          properties:
            firstName:
              type: string
            lastName:
              type: string
            phone:
              type: string
            avatar:
              type: string
              format: uri
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserProfileResponse:
      allOf:
        - $ref: "#/components/schemas/User"
        - type: object
          properties:
            globalRoles:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  displayName:
                    type: string
            businesses:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: string
                  code:
                    type: string
                  role:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      displayName:
                        type: string
                  isActive:
                    type: boolean
                  joinedAt:
                    type: string
                    format: date-time
            globalPermissions:
              type: array
              items:
                type: string
            businessPermissions:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string

    CreateUserRequest:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        profile:
          type: object
          properties:
            firstName:
              type: string
            lastName:
              type: string
            phone:
              type: string
      required:
        - username
        - email
        - password

    UpdateUserRequest:
      type: object
      properties:
        username:
          type: string
        profile:
          type: object
          properties:
            firstName:
              type: string
            lastName:
              type: string
            phone:
              type: string
            avatar:
              type: string
              format: uri

    UserResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/User"

    UserDetailResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/User"

    UserRole:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        roleId:
          type: string
        createdAt:
          type: string
          format: date-time
        role:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            displayName:
              type: string
            description:
              type: string

    AssignRoleRequest:
      type: object
      properties:
        roleId:
          type: string
          description: Role ID to assign
      required:
        - roleId

    # Business Management Schemas
    Business:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        code:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateBusinessRequest:
      type: object
      properties:
        name:
          type: string
          description: Business name
        code:
          type: string
          description: Unique business code
        description:
          type: string
          description: Business description
      required:
        - name
        - code

    UpdateBusinessRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    BusinessUser:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        businessId:
          type: string
        roleId:
          type: string
        isActive:
          type: boolean
        joinedAt:
          type: string
          format: date-time
        user:
          $ref: "#/components/schemas/User"
        business:
          $ref: "#/components/schemas/Business"
        role:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            displayName:
              type: string
            permissions:
              type: array
              items:
                type: string

    AssignBusinessRoleRequest:
      type: object
      properties:
        userId:
          type: string
          description: User ID to assign role to
        roleId:
          type: string
          description: Role ID to assign
      required:
        - userId
        - roleId

    # Permission Management Schemas
    Permission:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        displayName:
          type: string
        module:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreatePermissionRequest:
      type: object
      properties:
        name:
          type: string
          description: Permission name (e.g., user_create)
        displayName:
          type: string
          description: Display name for the permission
        module:
          type: string
          description: Module this permission belongs to
        description:
          type: string
          description: Description of the permission
      required:
        - name
        - displayName
        - module

    CreateMultiplePermissionsRequest:
      type: object
      properties:
        permissions:
          type: array
          items:
            $ref: "#/components/schemas/CreatePermissionRequest"
      required:
        - permissions

    UpdatePermissionRequest:
      type: object
      properties:
        displayName:
          type: string
        description:
          type: string

    # Role Management Schemas
    Role:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        displayName:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        permissions:
          type: array
          items:
            $ref: "#/components/schemas/Permission"

    CreateRoleRequest:
      type: object
      properties:
        name:
          type: string
          description: Role name (e.g., admin)
        displayName:
          type: string
          description: Display name for the role
        description:
          type: string
          description: Description of the role
      required:
        - name
        - displayName

    UpdateRoleRequest:
      type: object
      properties:
        displayName:
          type: string
        description:
          type: string

    RolePermission:
      type: object
      properties:
        id:
          type: string
        roleId:
          type: string
        permissionId:
          type: string
        createdAt:
          type: string
          format: date-time
        role:
          $ref: "#/components/schemas/Role"
        permission:
          $ref: "#/components/schemas/Permission"

    AssignPermissionRequest:
      type: object
      properties:
        permissionId:
          type: string
          description: Permission ID to assign
      required:
        - permissionId

    AssignMultiplePermissionsRequest:
      type: object
      properties:
        permissionIds:
          type: array
          items:
            type: string
          description: Array of permission IDs to assign
      required:
        - permissionIds

    # Authentication Schemas
    RegisterRequest:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        profile:
          type: object
          properties:
            firstName:
              type: string
            lastName:
              type: string
            phone:
              type: string
      required:
        - username
        - email
        - password

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required:
        - email
        - password

    ForgotPasswordRequest:
      type: object
      properties:
        email:
          type: string
          format: email
      required:
        - email

    ResetPasswordRequest:
      type: object
      properties:
        token:
          type: string
          description: Password reset token
        password:
          type: string
          format: password
      required:
        - token
        - password

    JoinBusinessRequest:
      type: object
      properties:
        businessCode:
          type: string
          description: Business code to join
        inviteCode:
          type: string
          description: Invite code for the business
      required:
        - businessCode
        - inviteCode

    ChangePasswordRequest:
      type: object
      properties:
        currentPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
      required:
        - currentPassword
        - newPassword

    # Account Schemas
    Account:
      type: object
      properties:
        id:
          type: string
          example: "clxy123456789"
        code:
          type: string
          example: "101"
        name:
          type: string
          example: "Kas"
        type:
          type: string
          enum: [ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE]
        category:
          type: string
          example: "Current Asset"
        balance:
          type: number
          format: decimal
          example: 1000000.00
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateAccountRequest:
      type: object
      properties:
        code:
          type: string
          example: "101"
        name:
          type: string
          example: "Kas"
        type:
          type: string
          enum: [ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE]
        category:
          type: string
          example: "Current Asset"
        balance:
          type: number
          format: decimal
          default: 0
      required:
        - code
        - name
        - type
        - category

    UpdateAccountRequest:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum: [ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE]
        category:
          type: string
        isActive:
          type: boolean

    AccountsResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/Account"

    AccountResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/Account"

    AccountDetailResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              allOf:
                - $ref: "#/components/schemas/Account"
                - type: object
                  properties:
                    debitEntries:
                      type: array
                      items:
                        $ref: "#/components/schemas/JournalEntry"
                    creditEntries:
                      type: array
                      items:
                        $ref: "#/components/schemas/JournalEntry"

    TrialBalanceResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                type: object
                properties:
                  code:
                    type: string
                  name:
                    type: string
                  type:
                    type: string
                  balance:
                    type: number
                    format: decimal

    # Journal Schemas
    Journal:
      type: object
      properties:
        id:
          type: string
        journalNo:
          type: string
          example: "JU-202507-0001"
        date:
          type: string
          format: date-time
        reference:
          type: string
        type:
          type: string
          enum: [GENERAL, SALES, PURCHASE, PAYMENT]
        totalAmount:
          type: number
          format: decimal
        status:
          type: string
          enum: [DRAFT, POSTED, CANCELLED]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    JournalEntry:
      type: object
      properties:
        id:
          type: string
        journalId:
          type: string
        debitAccountId:
          type: string
        creditAccountId:
          type: string
        description:
          type: string
        debitAmount:
          type: number
          format: decimal
        creditAmount:
          type: number
          format: decimal
        createdAt:
          type: string
          format: date-time
        debitAccount:
          $ref: "#/components/schemas/Account"
        creditAccount:
          $ref: "#/components/schemas/Account"

    CreateJournalRequest:
      type: object
      properties:
        date:
          type: string
          format: date
        reference:
          type: string
        type:
          type: string
          enum: [GENERAL, SALES, PURCHASE, PAYMENT]
        entries:
          type: array
          items:
            type: object
            properties:
              debitAccountId:
                type: string
              creditAccountId:
                type: string
              description:
                type: string
              debitAmount:
                type: number
                format: decimal
              creditAmount:
                type: number
                format: decimal
      required:
        - date
        - type
        - entries

    CreateSalesJournalRequest:
      type: object
      properties:
        saleId:
          type: string
        cashAccountId:
          type: string
        salesAccountId:
          type: string
        taxAccountId:
          type: string
      required:
        - saleId
        - cashAccountId
        - salesAccountId

    JournalsResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/Journal"

    JournalResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/Journal"

    JournalDetailResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              allOf:
                - $ref: "#/components/schemas/Journal"
                - type: object
                  properties:
                    entries:
                      type: array
                      items:
                        $ref: "#/components/schemas/JournalEntry"

    # Customer Schemas
    Customer:
      type: object
      properties:
        id:
          type: string
        code:
          type: string
          example: "CUST-0001"
        name:
          type: string
          example: "PT. Maju Jaya"
        address:
          type: string
        phone:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateCustomerRequest:
      type: object
      properties:
        name:
          type: string
          example: "PT. Maju Jaya"
        address:
          type: string
        phone:
          type: string
      required:
        - name

    UpdateCustomerRequest:
      type: object
      properties:
        name:
          type: string
        address:
          type: string
        phone:
          type: string

    CustomersResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/Customer"

    CustomerResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/Customer"

    CustomerDetailResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              allOf:
                - $ref: "#/components/schemas/Customer"
                - type: object
                  properties:
                    sales:
                      type: array
                      items:
                        $ref: "#/components/schemas/Sale"

    # Sales Schemas
    Sale:
      type: object
      properties:
        id:
          type: string
        saleNo:
          type: string
          example: "SALE-202507-0001"
        date:
          type: string
          format: date-time
        customerId:
          type: string
        subtotal:
          type: number
          format: decimal
        total:
          type: number
          format: decimal
        tax:
          type: number
          format: decimal
        status:
          type: string
          enum: [PENDING, CONFIRMED, COMPLETED, CANCELLED]
          default: "PENDING"
        journalId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SaleItem:
      type: object
      properties:
        id:
          type: string
        saleId:
          type: string
        productName:
          type: string
          example: "Laptop Asus"
        quantity:
          type: integer
          example: 1
        price:
          type: number
          format: decimal
          example: 800000.00
        amount:
          type: number
          format: decimal
          example: 800000.00

    CreateSaleRequest:
      type: object
      properties:
        customerId:
          type: string
        date:
          type: string
          format: date
        tax:
          type: number
          format: decimal
          default: 0
        items:
          type: array
          items:
            type: object
            properties:
              productName:
                type: string
                example: "Laptop Asus"
              quantity:
                type: integer
                example: 1
              price:
                type: number
                format: decimal
                example: 800000.00
            required:
              - productName
              - quantity
              - price
      required:
        - customerId
        - date
        - items

    UpdateSaleStatusRequest:
      type: object
      properties:
        status:
          type: string
          enum: [PENDING, CONFIRMED, COMPLETED, CANCELLED]
      required:
        - status

    SalesResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                allOf:
                  - $ref: "#/components/schemas/Sale"
                  - type: object
                    properties:
                      customer:
                        $ref: "#/components/schemas/Customer"
                      items:
                        type: array
                        items:
                          $ref: "#/components/schemas/SaleItem"

    SaleResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              allOf:
                - $ref: "#/components/schemas/Sale"
                - type: object
                  properties:
                    customer:
                      $ref: "#/components/schemas/Customer"
                    items:
                      type: array
                      items:
                        $ref: "#/components/schemas/SaleItem"

    SaleDetailResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              allOf:
                - $ref: "#/components/schemas/Sale"
                - type: object
                  properties:
                    customer:
                      $ref: "#/components/schemas/Customer"
                    items:
                      type: array
                      items:
                        $ref: "#/components/schemas/SaleItem"

    SalesReportResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                statusSummary:
                  type: array
                  items:
                    type: object
                    properties:
                      status:
                        type: string
                      _sum:
                        type: object
                        properties:
                          total:
                            type: number
                            format: decimal
                      _count:
                        type: object
                        properties:
                          id:
                            type: integer
                topProducts:
                  type: array
                  items:
                    type: object
                    properties:
                      productName:
                        type: string
                      _sum:
                        type: object
                        properties:
                          quantity:
                            type: integer
                          amount:
                            type: number
                            format: decimal
                monthlyData:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      total:
                        type: number
                        format: decimal
                      count:
                        type: integer

    # Recommendation Schemas
    Recommendation:
      type: object
      properties:
        id:
          type: string
        year:
          type: integer
          example: 2025
        month:
          type: integer
          example: 7
        recommendationType:
          type: string
          example: "CostSaving"
        recommendationText:
          type: string
          example: "Berdasarkan analisis data keuangan..."
        isCustom:
          type: boolean
          default: false
        customPrompt:
          type: string
        userId:
          type: string
        metadata:
          type: object
        isActive:
          type: boolean
          default: true
        deletedAt:
          type: string
          format: date-time
        archivedAt:
          type: string
          format: date-time
        generatedAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    GenerateMonthlyRecommendationRequest:
      type: object
      properties:
        year:
          type: integer
          example: 2025
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 7
      required:
        - year
        - month

    GenerateCustomRecommendationRequest:
      type: object
      properties:
        prompt:
          type: string
          example: "Bagaimana cara meningkatkan efisiensi operasional?"
        year:
          type: integer
          example: 2025
        month:
          type: integer
          example: 7
        includeFinancialData:
          type: boolean
          default: false
        userId:
          type: string
        model:
          type: string
        temperature:
          type: number
          format: float
          minimum: 0
          maximum: 2
        maxTokens:
          type: integer
      required:
        - prompt

    GenerateVariationsRequest:
      type: object
      properties:
        year:
          type: integer
          example: 2025
        month:
          type: integer
          example: 7
        variations:
          type: integer
          default: 3
          minimum: 1
          maximum: 10
      required:
        - year
        - month

    AnalyzeFinancialDataRequest:
      type: object
      properties:
        year:
          type: integer
          example: 2025
        month:
          type: integer
          example: 7
      required:
        - year
        - month

    UpdateRecommendationRequest:
      type: object
      properties:
        recommendationType:
          type: string
        recommendationText:
          type: string
        isActive:
          type: boolean
        customPrompt:
          type: string
        metadata:
          type: object

    RegenerateRecommendationRequest:
      type: object
      properties:
        forceRegenerate:
          type: boolean
          default: false

    BulkDeleteRequest:
      type: object
      properties:
        ids:
          type: array
          items:
            type: string
          example: ["id1", "id2", "id3"]
      required:
        - ids

    RecommendationsResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: "#/components/schemas/Recommendation"
            pagination:
              type: object
              properties:
                total:
                  type: integer
                limit:
                  type: integer
                offset:
                  type: integer
                hasMore:
                  type: boolean
                totalPages:
                  type: integer
                currentPage:
                  type: integer
            statistics:
              type: object
              properties:
                byType:
                  type: object
                  additionalProperties:
                    type: integer
                total:
                  type: integer

    RecommendationResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/Recommendation"

    RecommendationGeneratedResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                recommendation:
                  $ref: "#/components/schemas/Recommendation"
                financialSummary:
                  type: object
                  properties:
                    totalRevenue:
                      type: number
                      format: decimal
                    totalExpense:
                      type: number
                      format: decimal
                    netIncome:
                      type: number
                      format: decimal
            meta:
              type: object
              properties:
                aiRawOutput:
                  type: string
                generatedAt:
                  type: string
                  format: date-time

    CustomRecommendationResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              $ref: "#/components/schemas/Recommendation"
            meta:
              type: object
              properties:
                originalPrompt:
                  type: string
                finalPrompt:
                  type: string
                aiRawOutput:
                  type: string
                aiOptions:
                  type: object

    VariationsResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                variations:
                  type: array
                  items:
                    type: object
                    properties:
                      variation:
                        type: integer
                      text:
                        type: string
                      approach:
                        type: string
                financialSummary:
                  type: object
                  properties:
                    totalRevenue:
                      type: number
                      format: decimal
                    totalExpense:
                      type: number
                      format: decimal
                    netIncome:
                      type: number
                      format: decimal
            meta:
              type: object
              properties:
                year:
                  type: integer
                month:
                  type: integer
                variationCount:
                  type: integer
                generatedAt:
                  type: string
                  format: date-time

    FinancialAnalysisResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                analysis:
                  type: object
                  properties:
                    recommendedType:
                      type: string
                    reasoning:
                      type: string
                    priority:
                      type: string
                      enum: [high, medium, low]
                    keyInsights:
                      type: array
                      items:
                        type: string
                financialData:
                  type: object
                  properties:
                    totalRevenue:
                      type: number
                      format: decimal
                    totalExpense:
                      type: number
                      format: decimal
                    netIncome:
                      type: number
                      format: decimal
                    transactionCount:
                      type: integer
            meta:
              type: object
              properties:
                year:
                  type: integer
                month:
                  type: integer
                analyzedAt:
                  type: string
                  format: date-time

    RegenerateResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                recommendation:
                  $ref: "#/components/schemas/Recommendation"
                financialSummary:
                  type: object
            meta:
              type: object
              properties:
                regenerated:
                  type: boolean
                previousRecommendation:
                  $ref: "#/components/schemas/Recommendation"
                aiRawOutput:
                  type: string

    BulkDeleteResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                deletedCount:
                  type: integer
                requestedIds:
                  type: array
                  items:
                    type: string

    AITestResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                success:
                  type: boolean
                model:
                  type: string
                response:
                  type: string
                timestamp:
                  type: string
                  format: date-time
                error:
                  type: string

    AIModelsResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                models:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      description:
                        type: string
                currentModel:
                  type: string
                config:
                  type: object
                  properties:
                    configured:
                      type: boolean
                    model:
                      type: string
                    baseUrl:
                      type: string
                    siteUrl:
                      type: string
                    siteName:
                      type: string
                    hasApiKey:
                      type: boolean

    ServiceStatusResponse:
      allOf:
        - $ref: "#/components/schemas/SuccessResponse"
        - type: object
          properties:
            data:
              type: object
              properties:
                database:
                  type: object
                  properties:
                    status:
                      type: string
                      enum: [healthy, unhealthy]
                    message:
                      type: string
                    recommendationCount:
                      type: integer
                aiService:
                  type: object
                  properties:
                    status:
                      type: string
                      enum: [healthy, unhealthy]
                    message:
                      type: string
                statistics:
                  type: object
                  properties:
                    totalRecommendations:
                      type: integer
                    activeRecommendations:
                      type: integer
                    customRecommendations:
                      type: integer
                    systemRecommendations:
                      type: integer
                timestamp:
                  type: string
                  format: date-time
                version:
                  type: string
